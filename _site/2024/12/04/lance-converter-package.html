<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="Python Package to convert image datasets to lance type" /><meta property="og:locale" content="en_US" /><meta name="description" content="This post gives a detailed overview of how we can convert any image dataset to lance using a python package" /><meta property="og:description" content="This post gives a detailed overview of how we can convert any image dataset to lance using a python package" /><link rel="canonical" href="http://localhost:4000/2024/12/04/lance-converter-package" /><meta property="og:url" content="http://localhost:4000/2024/12/04/lance-converter-package" /><meta property="og:site_name" content="Deox Labs" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-12-04T00:00:00+05:30" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Python Package to convert image datasets to lance type" /><meta name="twitter:site" content="@fuxssss" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2024-12-04T00:00:00+05:30","datePublished":"2024-12-04T00:00:00+05:30","description":"This post gives a detailed overview of how we can convert any image dataset to lance using a python package","headline":"Python Package to convert image datasets to lance type","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/2024/12/04/lance-converter-package"},"url":"http://localhost:4000/2024/12/04/lance-converter-package"}</script><title> Python Package to convert image datasets to lance type - Deox Labs</title><link rel="shortcut icon" href="/favicon.png"><link rel="alternate" type="application/atom+xml" title="Deox Labs" href="/atom.xml"><link rel="alternate" type="application/json" title="Deox Labs" href="http://localhost:4000/feed.json" /><link rel="sitemap" type="application/xml" title="sitemap" href="/sitemap.xml" /><style> *,:after,:before{box-sizing:border-box;background-color:inherit;color:inherit;margin:0;padding:0}body{font-family:system-ui,sans-serif;-webkit-font-smoothing:antialiased;text-rendering:optimizeLegibility;line-height:1.5;font-size:1rem;color:#16171a}nav ul{border-right:1px solid #edf2f7}a{color:#000;text-decoration-skip-ink:auto;text-decoration:underline}pre{margin:.5rem 0;padding:.5rem}.post p{margin:.5rem 0}.post h1,.post h2,.post h3,.post h4{margin:1rem 0}.post h2:first-child,.project h2:first-child,.photo h2:first-child{margin-top:0}.meta{margin:2rem 0}code,pre{background:#f5f5f5;max-width:100%;overflow-x:auto}code{padding:.1rem;font-size:.85rem}pre code{border:none}pre{padding:1rem;overflow-x:auto}img{max-width:100%;background:none;display:block;margin:auto}hr{background:#000;height:1px;border:0}header{flex-basis:10rem;flex-grow:1;position:relative}header a{text-decoration:none}header li{margin-bottom:.2rem;text-align:right;margin-right:2rem}header a.active{font-weight:bold}header,section{padding:1rem}blockquote{font-style:italic;border-left:5px solid #ececec;padding-left:1rem}h1,h2,h3,h4,h5{line-height:1;margin:1rem 0;font-weight:600}section h1:first-child{margin-top:0}strong,b{font-weight:bold}.photos ul{list-style:none}.photos li{margin-bottom:1.5rem}.photo picture,.project picture{margin-bottom:.5rem}.posts ul,header ul{list-style:none}.posts li{align-items:center;display:flex;justify-content:space-between;margin-bottom:.5rem}.posts li a,.posts li div,.projects li a{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;text-decoration:none}.posts li time,.projects li time{padding-left:1rem;white-space:nowrap;font-variant-numeric:tabular-nums}.post ol,.project ul,.post ol,.post ul{padding-left:1rem}main{display:flex;flex-wrap:wrap;max-width:60rem;margin:2rem auto;padding:1rem}@media screen and (max-width: 45rem){header li{display:inline;margin-right:1rem}.logo{padding-bottom:1rem}header ul{border-bottom:1px solid #edf2f7;padding-bottom:2rem}nav ul{border-right:0px}.photos ul{margin-top:.5rem}}section{flex-basis:0;flex-grow:999;min-width:70%;display:flex;flex-direction:column}figcaption{font-size:smaller}@media print{.no-print,.no-print *{display:none !important}}.back-to-top{position:fixed;bottom:20px;right:20px;background-color:#fff;color:#000;padding:10px;text-decoration:none;border-radius:5px;display:block;margin-right:20%}</style></head><body><main><header aria-hidden="true" class="no-print"> <!--<h1 class="logo">Deox Labs</h1>--><nav role="navigation" aria-hidden="true"><ul><li><a href="/" >Home</a></li><li><a href="/about" >About</a></li><li><a href="/contact" >Contact</a></li><li><a href="/projects" >Projects</a></li><li><a href="/search" >Search</a></li></ul></nav></header><section class="post"><h1>Python Package to convert image datasets to lance type</h1><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/lancify-title-image.png?raw=true" alt="cli-lancify-title-image" /></p><p>A few months ago, I wrote two articles on how the Lance format can supercharge your machine learning workflows. In the <a href="https://vipul-maheshwari.github.io/2024/03/29/effortlessly-loading-and-processing-images-with-lance-a-code-walkthrough">first</a>, I showed how Lanceâ€™s columnar storage can make handling large image datasets much more efficient for the ML workflows. Then, I followed up with a <a href="https://vipul-maheshwari.github.io/2024/04/09/convert-any-image-dataset-to-lance">guide</a> on converting datasets like <a href="https://www.kaggle.com/datasets/vipulmaheshwarii/cinic-10-lance-dataset?ref=blog.lancedb.com">cinic</a> and <a href="https://www.kaggle.com/datasets/vipulmaheshwarii/mini-imagenet-lance-dataset?ref=blog.lancedb.com">mini-imagenet</a> into Lance format using a custom Python script in <a href="https://colab.research.google.com/drive/12RjdHmp6m9_Lx7YMRiat4_fYWZ2g63gx?usp=sharing&amp;ref=blog.lancedb.com">Google Colab</a>. While that worked well, it was a bit manual.</p><p>Well, Some of my friends are lazy as <code>fuxcks</code> but excited enough to run the colab and use the Lance formatted datatype for some of their experiments. Being a good friend, Iâ€™m excited to share a much easier solution: the <code>lancify</code> Python package.</p><p>I mean itâ€™s literally just running a one command, and boom â€” your image datasets are in lance format, ready to go. And, just between us, it makes my life a lot easier too.</p><h3 id="installing-the-package">Installing the Package</h3><p>Before diving into the conversion process, letâ€™s start by installing the <code>lancify</code> package. You can easily install it via pip:</p><pre><code class="language-bash">pip install lancify
</code></pre><h3 id="converting-your-image-dataset-to-lance">Converting Your Image Dataset to Lance</h3><p>Once youâ€™ve installed the package, converting any image dataset to the Lance format is as simple as running the following Python code. The <code>lancify</code> package abstracts away the complexity of running the colab notebooks manually;</p><pre><code class="language-python">from lancify.converter import convert_dataset

# Define the path to your image dataset
image_dataset_path = 'cards-classification'
resize_dimensions = (256, 256)  # Example resize dimensions
splits = ["train", "test", "valid"]

convert_dataset(
    dataset_path=image_dataset_path,
    batch_size=10,  # You can adjust the batch size as needed
    resize=resize_dimensions,  # Pass resize dimensions if you want to resize images
    splits=splits
)
</code></pre><p>For this demonstration, I have used this <a href="https://www.kaggle.com/datasets/gpiosenka/cards-image-datasetclassification">dataset</a>, which provides flexibility in terms of image resizing and dataset splits. The image resizing is optional; by default, the images are processed with their original dimensions. However, if needed, you can specify a target size, such as 256x256, by passing the desired dimensions. If you prefer to keep the original size, simply pass None for the resize parameter. Regarding dataset splits, if the dataset includes predefined divisions like training, testing, and validation sets, you can pass a list specifying the relevant splits.</p><p>For <a href="https://www.kaggle.com/datasets/jehanbhathena/weather-dataset">datasets</a> that do not have predefined splits, the images are organized by classification labels. In such cases, you only need to provide the dataset path, and a single lance file will be generated, containing all the images with their corresponding labels. This makes sure that the various kinds of image datasets are handled properly whether they include splits or not.</p><pre><code class="language-python">from lancify.converter import convert_dataset

image_dataset_path = 'weather-classification-data'

convert_dataset(
    dataset_path=image_dataset_path,
    batch_size=10,  # You can adjust the batch size as needed
)
</code></pre><p>The <code>convert_dataset</code> function automatically handles the following:</p><ol><li><strong>Reading the image data</strong> â€“ It reads image files and their metadata (filename, category, data split).</li><li><strong>Converting to Lance</strong> â€“ The images are converted into the Lance format with proper schema.</li><li><strong>Saving the Lance files</strong> â€“ Lance files are saved for each dataset split (train, test, validation) if there are splits in the dataset, if not then a single lance file is saved with the combined data with an adequate schema to segregate the data with the respective labels.</li></ol><p>This method is far more concise than manually iterating over directories, creating schemas, and writing to lance files as we did in the previous version using raw colab.</p><h3 id="cli-sdk">CLI SDK</h3><p>In addition to using the <code>lancify</code> package programmatically through the imported function, you can also leverage the CLI SDK to convert your image datasets. The SDK offers a CLI for the <code>lancify</code>.</p><p>To use the CLI, all you need to do is install the package with <code>pip install lancify</code> and then run the <code>lancify</code> command in your terminal and follow the args.</p><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/cli-lancify.png?raw=true" alt="image-cli" /></p><h3 id="whats-happened-behind-the-scenes">Whatâ€™s Happened Behind the Scenes?</h3><p>To give you a better understanding, hereâ€™s a brief overview of what happens when you use <code>lancify</code>:</p><ul><li><strong>Image Data</strong>: The package reads images from your dataset directory and converts them into a binary format.</li><li><strong>Metadata Extraction</strong>: Metadata such as the imageâ€™s filename, category (label), and data split (train/test/validation) are automatically extracted.</li><li><strong>PyArrow RecordBatch</strong>: The image data and metadata are packaged into a PyArrow <code>RecordBatch</code> for efficient columnar storage.</li><li><strong>Lance Dataset Creation</strong>: These <code>RecordBatch</code> objects are then written to Lance datasets, which are optimized for performance and storage.</li></ul><p>This process mirrors the manual steps we previously took but in a much more user-friendly manner, significantly reducing the boilerplate code that was necessary before when you have to manually handle the <a href="https://colab.research.google.com/drive/12RjdHmp6m9_Lx7YMRiat4_fYWZ2g63gx?usp=sharing#scrollTo=93qlCg6TpcW-">colab</a></p><h3 id="loading-your-dataset-into-pandas">Loading Your Dataset into Pandas</h3><p>Once your image dataset has been converted into the lance format, you can seamlessly load it into pandas data frames for doing all kind of stuff. Hereâ€™s how to do it for the <code>card-classification</code> training lance file..</p><pre><code class="language-python">import lance
import pandas as pd

# Load Lance dataset
ds = lance.dataset('cards-classification/cards-classification_train.lance')
table = ds.to_table()

# Convert Lance table to Pandas dataframe
df = table.to_pandas()
print(df.head())
</code></pre><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/lance-training.png?raw=true" alt="lance-training" /></p><p>This is a simple and efficient way to convert your image datasets to the lance format using the <code>lancify</code> package, and it integrates smoothly into your deep learning projects.</p><p>Switching to the Lance format makes your data pipelines faster and more efficient, especially when dealing with large image datasets. All you need to do is install the package and run the conversion script on your datasetsâ€”no hassle.</p><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/child-meme-lancify.png?raw=true" alt="meme-maker" /></p><p>Just this small change can really speed up your machine learning workflowsâ€”data loading and processing become much quicker, which means your models train faster. If you need a reference, this is a <a href="https://vipul-maheshwari.github.io/2024/06/26/train-a-cnn-with-lancedataset">quickie</a> on how to use the lance formatted image datasets for training you deep learning models. And if youâ€™re looking for more ideas, there are plenty of other <a href="https://github.com/lancedb/lance-deeplearning-recipes">deep learning recipes</a> built on lance.</p><p>Trust me, itâ€™s worth it! ðŸ¤—</p><span class="meta"><time datetime="2024-12-04T00:00:00+05:30">December 4, 2024</time></span></section><!-- --- layout: default ---<section class="post"><h2>Python Package to convert image datasets to lance type</h2><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/lancify-title-image.png?raw=true" alt="cli-lancify-title-image" /></p><p>A few months ago, I wrote two articles on how the Lance format can supercharge your machine learning workflows. In the <a href="https://vipul-maheshwari.github.io/2024/03/29/effortlessly-loading-and-processing-images-with-lance-a-code-walkthrough">first</a>, I showed how Lanceâ€™s columnar storage can make handling large image datasets much more efficient for the ML workflows. Then, I followed up with a <a href="https://vipul-maheshwari.github.io/2024/04/09/convert-any-image-dataset-to-lance">guide</a> on converting datasets like <a href="https://www.kaggle.com/datasets/vipulmaheshwarii/cinic-10-lance-dataset?ref=blog.lancedb.com">cinic</a> and <a href="https://www.kaggle.com/datasets/vipulmaheshwarii/mini-imagenet-lance-dataset?ref=blog.lancedb.com">mini-imagenet</a> into Lance format using a custom Python script in <a href="https://colab.research.google.com/drive/12RjdHmp6m9_Lx7YMRiat4_fYWZ2g63gx?usp=sharing&amp;ref=blog.lancedb.com">Google Colab</a>. While that worked well, it was a bit manual.</p><p>Well, Some of my friends are lazy as <code>fuxcks</code> but excited enough to run the colab and use the Lance formatted datatype for some of their experiments. Being a good friend, Iâ€™m excited to share a much easier solution: the <code>lancify</code> Python package.</p><p>I mean itâ€™s literally just running a one command, and boom â€” your image datasets are in lance format, ready to go. And, just between us, it makes my life a lot easier too.</p><h3 id="installing-the-package">Installing the Package</h3><p>Before diving into the conversion process, letâ€™s start by installing the <code>lancify</code> package. You can easily install it via pip:</p><pre><code class="language-bash">pip install lancify
</code></pre><h3 id="converting-your-image-dataset-to-lance">Converting Your Image Dataset to Lance</h3><p>Once youâ€™ve installed the package, converting any image dataset to the Lance format is as simple as running the following Python code. The <code>lancify</code> package abstracts away the complexity of running the colab notebooks manually;</p><pre><code class="language-python">from lancify.converter import convert_dataset

# Define the path to your image dataset
image_dataset_path = 'cards-classification'
resize_dimensions = (256, 256)  # Example resize dimensions
splits = ["train", "test", "valid"]

convert_dataset(
    dataset_path=image_dataset_path,
    batch_size=10,  # You can adjust the batch size as needed
    resize=resize_dimensions,  # Pass resize dimensions if you want to resize images
    splits=splits
)
</code></pre><p>For this demonstration, I have used this <a href="https://www.kaggle.com/datasets/gpiosenka/cards-image-datasetclassification">dataset</a>, which provides flexibility in terms of image resizing and dataset splits. The image resizing is optional; by default, the images are processed with their original dimensions. However, if needed, you can specify a target size, such as 256x256, by passing the desired dimensions. If you prefer to keep the original size, simply pass None for the resize parameter. Regarding dataset splits, if the dataset includes predefined divisions like training, testing, and validation sets, you can pass a list specifying the relevant splits.</p><p>For <a href="https://www.kaggle.com/datasets/jehanbhathena/weather-dataset">datasets</a> that do not have predefined splits, the images are organized by classification labels. In such cases, you only need to provide the dataset path, and a single lance file will be generated, containing all the images with their corresponding labels. This makes sure that the various kinds of image datasets are handled properly whether they include splits or not.</p><pre><code class="language-python">from lancify.converter import convert_dataset

image_dataset_path = 'weather-classification-data'

convert_dataset(
    dataset_path=image_dataset_path,
    batch_size=10,  # You can adjust the batch size as needed
)
</code></pre><p>The <code>convert_dataset</code> function automatically handles the following:</p><ol><li><strong>Reading the image data</strong> â€“ It reads image files and their metadata (filename, category, data split).</li><li><strong>Converting to Lance</strong> â€“ The images are converted into the Lance format with proper schema.</li><li><strong>Saving the Lance files</strong> â€“ Lance files are saved for each dataset split (train, test, validation) if there are splits in the dataset, if not then a single lance file is saved with the combined data with an adequate schema to segregate the data with the respective labels.</li></ol><p>This method is far more concise than manually iterating over directories, creating schemas, and writing to lance files as we did in the previous version using raw colab.</p><h3 id="cli-sdk">CLI SDK</h3><p>In addition to using the <code>lancify</code> package programmatically through the imported function, you can also leverage the CLI SDK to convert your image datasets. The SDK offers a CLI for the <code>lancify</code>.</p><p>To use the CLI, all you need to do is install the package with <code>pip install lancify</code> and then run the <code>lancify</code> command in your terminal and follow the args.</p><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/cli-lancify.png?raw=true" alt="image-cli" /></p><h3 id="whats-happened-behind-the-scenes">Whatâ€™s Happened Behind the Scenes?</h3><p>To give you a better understanding, hereâ€™s a brief overview of what happens when you use <code>lancify</code>:</p><ul><li><strong>Image Data</strong>: The package reads images from your dataset directory and converts them into a binary format.</li><li><strong>Metadata Extraction</strong>: Metadata such as the imageâ€™s filename, category (label), and data split (train/test/validation) are automatically extracted.</li><li><strong>PyArrow RecordBatch</strong>: The image data and metadata are packaged into a PyArrow <code>RecordBatch</code> for efficient columnar storage.</li><li><strong>Lance Dataset Creation</strong>: These <code>RecordBatch</code> objects are then written to Lance datasets, which are optimized for performance and storage.</li></ul><p>This process mirrors the manual steps we previously took but in a much more user-friendly manner, significantly reducing the boilerplate code that was necessary before when you have to manually handle the <a href="https://colab.research.google.com/drive/12RjdHmp6m9_Lx7YMRiat4_fYWZ2g63gx?usp=sharing#scrollTo=93qlCg6TpcW-">colab</a></p><h3 id="loading-your-dataset-into-pandas">Loading Your Dataset into Pandas</h3><p>Once your image dataset has been converted into the lance format, you can seamlessly load it into pandas data frames for doing all kind of stuff. Hereâ€™s how to do it for the <code>card-classification</code> training lance file..</p><pre><code class="language-python">import lance
import pandas as pd

# Load Lance dataset
ds = lance.dataset('cards-classification/cards-classification_train.lance')
table = ds.to_table()

# Convert Lance table to Pandas dataframe
df = table.to_pandas()
print(df.head())
</code></pre><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/lance-training.png?raw=true" alt="lance-training" /></p><p>This is a simple and efficient way to convert your image datasets to the lance format using the <code>lancify</code> package, and it integrates smoothly into your deep learning projects.</p><p>Switching to the Lance format makes your data pipelines faster and more efficient, especially when dealing with large image datasets. All you need to do is install the package and run the conversion script on your datasetsâ€”no hassle.</p><p><img src="https://github.com/vipul-maheshwari/vipul-maheshwari.github.io/blob/main/images/cli-for-lance-converter/child-meme-lancify.png?raw=true" alt="meme-maker" /></p><p>Just this small change can really speed up your machine learning workflowsâ€”data loading and processing become much quicker, which means your models train faster. If you need a reference, this is a <a href="https://vipul-maheshwari.github.io/2024/06/26/train-a-cnn-with-lancedataset">quickie</a> on how to use the lance formatted image datasets for training you deep learning models. And if youâ€™re looking for more ideas, there are plenty of other <a href="https://github.com/lancedb/lance-deeplearning-recipes">deep learning recipes</a> built on lance.</p><p>Trust me, itâ€™s worth it! ðŸ¤—</p><span class="meta"><time datetime="2024-12-04T00:00:00+05:30">December 4, 2024</time> &middot; <a href="/tag/LanceDB">LanceDB</a>, <a href="/tag/Dataset">Dataset</a>, <a href="/tag/Python">Python</a>, <a href="/tag/Package">Package</a></span>--> <!--</section>--></main><script async src="https://www.googletagmanager.com/gtag/js?id=G-JBZRCCYMBP"></script> <script> window.dataLayer = window.dataLayer || []; function gtag() { dataLayer.push(arguments); } gtag('js', new Date()); gtag('config', 'G-JBZRCCYMBP'); </script></body></html>
